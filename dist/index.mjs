var c=(s,e,o)=>new Promise((n,t)=>{var p=r=>{try{u(o.next(r))}catch(g){t(g)}},d=r=>{try{u(o.throw(r))}catch(g){t(g)}},u=r=>r.done?n(r.value):Promise.resolve(r.value).then(p,d);u((o=o.apply(s,e)).next())});import h from"express";import{createServer as O}from"http";import{MongoClient as i}from"mongodb";var a=class{connect(e){return new i(e)}testConnection(e){return c(this,null,function*(){try{yield new i(e).connect()}catch(o){throw{message:"N\xE3o foi poss\xEDvel se comunicar com o mongodb. Verifique a Url.",error:o.message}}})}saveJson(e){return c(this,null,function*(){console.log(e);let o=new i(process.env.MONGO_URL);console.log(process.env.MONGO_URL);let n=o.db("chuck_db").collection("chuck_collection"),t=yield n.countDocuments();console.log(t);let p={descricao:e,numero:t};return yield n.insertOne(p)})}getRandomJoke(){return c(this,null,function*(){let e=new i(process.env.MONGO_URL);console.log(process.env.MONGO_URL);let o=e.db("chuck_db").collection("chuck_collection"),n=yield o.countDocuments();console.log(n);let t=yield o.findOne({numero:this.getRandomInt(0,n)});return console.log(t),t})}getAllJokes(){return c(this,null,function*(){let n=yield new i(process.env.MONGO_URL).db("chuck_db").collection("chuck_collection").find({}).toArray();return console.log(n),n})}getRandomInt(e,o){let n=Math.ceil(e),t=Math.floor(o);return Math.floor(Math.random()*(t-n)+n)}};var m=class{constructor(){this.mongodbService=new a}saveJoke(e,o){return c(this,null,function*(){yield this.mongodbService.saveJson(e.body.joke_description),o.status(200).send()})}getJoke(e,o){return c(this,null,function*(){let n=yield this.mongodbService.getRandomJoke();o.status(200).send(n)})}getAllJokes(e,o){return c(this,null,function*(){let n=yield this.mongodbService.getAllJokes();o.status(200).send(n)})}};import"dotenv/config";var l=h();l.use(function(s,e,o){e.header("Access-Control-Allow-Origin","*"),e.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),e.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, DELETE"),o()});var R=new m,w=O(l),k=8080;l.use(h.json());w.listen(k,()=>{console.log(`Server is running on port ${k}`),console.log(process.env.MONGO_URL)});l.get("/joke",(s,e)=>{R.getJoke(s,e)});l.get("/jokes",(s,e)=>{R.getAllJokes(s,e)});l.post("/joke",(s,e)=>{console.log(process.env.MONGO_URL),R.saveJoke(s,e)});
